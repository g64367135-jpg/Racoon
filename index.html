<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë„ˆêµ¬ë¦¬ ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px;
            max-width: 600px;
            width: 100%;
        }

        .login-screen, .game-screen, .gameover-screen {
            display: none;
        }

        .login-screen.active, .game-screen.active, .gameover-screen.active {
            display: block;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        .game-icon {
            text-align: center;
            font-size: 4em;
            margin-bottom: 20px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(17, 153, 142, 0.4);
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-weight: 600;
            font-size: 18px;
        }

        #gameCanvas {
            border: 4px solid #f59e0b;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            background: #2d3748;
        }

        .instructions {
            text-align: center;
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }

        .leaderboard {
            margin-top: 20px;
            background: #f9fafb;
            border-radius: 10px;
            padding: 20px;
        }

        .leaderboard h3 {
            color: #333;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: white;
        }

        .leaderboard-item:nth-child(1) {
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
        }

        .leaderboard-item:nth-child(2) {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
        }

        .leaderboard-item:nth-child(3) {
            background: linear-gradient(135deg, #cd7f32 0%, #d4a574 100%);
        }

        .rank {
            font-weight: bold;
            font-size: 18px;
            width: 30px;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: 600;
            color: #333;
        }

        .player-id {
            font-size: 12px;
            color: #666;
        }

        .score-info {
            text-align: right;
        }

        .score {
            font-weight: bold;
            color: #667eea;
            font-size: 18px;
        }

        .level {
            font-size: 12px;
            color: #666;
        }

        .final-score {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .final-score-value {
            font-size: 48px;
            font-weight: bold;
            margin: 10px 0;
        }

        .empty-leaderboard {
            text-align: center;
            color: #999;
            padding: 20px;
        }

        .player-display {
            text-align: center;
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            font-weight: 600;
            color: #333;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ë¡œê·¸ì¸ í™”ë©´ -->
        <div class="login-screen active" id="loginScreen">
            <div class="game-icon">ğŸ¦</div>
            <h1>ë„ˆêµ¬ë¦¬ ê²Œì„</h1>
            <p class="subtitle">ë¡œê·¸ì¸í•˜ì—¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”!</p>

            <div class="input-group">
                <label for="userName">ì´ë¦„</label>
                <input type="text" id="userName" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <div class="input-group">
                <label for="studentId">í•™ë²ˆ</label>
                <input type="text" id="studentId" placeholder="í•™ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”">
            </div>

            <button class="btn-primary" id="loginBtn" disabled>ê²Œì„ ì‹œì‘</button>
            <button class="btn-secondary" id="showLeaderboardBtn">ìˆœìœ„í‘œ ë³´ê¸°</button>

            <div class="leaderboard" id="leaderboardLogin" style="display: none;">
                <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h3>
                <div id="leaderboardListLogin"></div>
            </div>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div class="game-screen" id="gameScreen">
            <div class="game-info">
                <div class="info-item">â­ ë ˆë²¨: <span id="level">1</span></div>
                <div class="info-item">ğŸ† ì ìˆ˜: <span id="score">0</span></div>
                <div class="info-item">â¤ï¸ ìƒëª…: <span id="lives">3</span></div>
                <div class="info-item">ğŸ ê³¼ì¼: <span id="fruits">7</span></div>
            </div>

            <canvas id="gameCanvas" width="480" height="480"></canvas>

            <div class="player-display" id="playerDisplay"></div>
            <div class="instructions">â¬†ï¸â¬‡ï¸â¬…ï¸â¡ï¸ í™”ì‚´í‘œ í‚¤ë¡œ ë„ˆêµ¬ë¦¬ë¥¼ ì¡°ì¢…í•˜ì„¸ìš”!</div>
        </div>

        <!-- ê²Œì„ ì˜¤ë²„ í™”ë©´ -->
        <div class="gameover-screen" id="gameoverScreen">
            <div class="game-icon">ğŸ’€</div>
            <h1>ê²Œì„ ì˜¤ë²„!</h1>
            
            <div class="final-score">
                <p>ìµœì¢… ì ìˆ˜</p>
                <div class="final-score-value" id="finalScore">0</div>
                <p id="finalLevel">ë ˆë²¨ 1</p>
            </div>

            <button class="btn-success" id="replayBtn">ë‹¤ì‹œ í”Œë ˆì´</button>
            <button class="btn-secondary" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>

            <div class="leaderboard">
                <h3>ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹</h3>
                <div id="leaderboardListGame"></div>
            </div>
        </div>
    </div>

    <script>
        // Firebase ì„¤ì • (ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì—¬ê¸°ì— Firebase ì„¤ì •ì„ ë„£ìœ¼ì„¸ìš”)
        var FIREBASE_CONFIG = {
            apiKey: "AIzaSyDsmgFuC6RUN2C2Br5o_AD1bCtftTVSrqM",
  authDomain: "racoon-6bdf9.firebaseapp.com",
  databaseURL: "https://racoon-6bdf9-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "racoon-6bdf9",
  storageBucket: "racoon-6bdf9.firebasestorage.app",
  messagingSenderId: "1038545707676",
  appId: "1:1038545707676:web:9cc0416a9b5f6246860359"
};

        // ê²Œì„ ìƒìˆ˜
        var GRID_SIZE = 15;
        var CELL_SIZE = 32;
        var GAME_SPEED = 150;

        // ê²Œì„ ë³€ìˆ˜
        var canvas, ctx;
        var raccoon = { x: 1, y: 1 };
        var direction = { x: 1, y: 0 };
        var fruits = [];
        var obstacles = [];
        var score = 0;
        var level = 1;
        var lives = 3;
        var gameInterval;
        var userName = '';
        var studentId = '';
        var leaderboard = [];

        // í™”ë©´ ìš”ì†Œ
        var loginScreen = document.getElementById('loginScreen');
        var gameScreen = document.getElementById('gameScreen');
        var gameoverScreen = document.getElementById('gameoverScreen');
        var userNameInput = document.getElementById('userName');
        var studentIdInput = document.getElementById('studentId');
        var loginBtn = document.getElementById('loginBtn');

        // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ìˆœìœ„í‘œ ë¡œë“œ
        function loadLeaderboard() {
            var stored = localStorage.getItem('raccoonGameLeaderboard');
            if (stored) {
                leaderboard = JSON.parse(stored);
            }
            updateLeaderboardDisplay();
        }

        // ìˆœìœ„í‘œ ì €ì¥
        function saveLeaderboard() {
            localStorage.setItem('raccoonGameLeaderboard', JSON.stringify(leaderboard));
        }

        // ì ìˆ˜ ì €ì¥
        function saveScore(finalScore, finalLevel) {
            var newEntry = {
                name: userName,
                studentId: studentId,
                score: finalScore,
                level: finalLevel,
                date: new Date().toLocaleDateString('ko-KR')
            };

            leaderboard.push(newEntry);
            leaderboard.sort(function(a, b) { return b.score - a.score; });
            leaderboard = leaderboard.slice(0, 10);
            saveLeaderboard();
            updateLeaderboardDisplay();
        }

        // ìˆœìœ„í‘œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateLeaderboardDisplay() {
            var lists = [
                document.getElementById('leaderboardListLogin'),
                document.getElementById('leaderboardListGame')
            ];

            lists.forEach(function(list) {
                if (!list) return;
                
                if (leaderboard.length === 0) {
                    list.innerHTML = '<div class="empty-leaderboard">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                } else {
                    list.innerHTML = leaderboard.map(function(entry, index) {
                        return '<div class="leaderboard-item">' +
                            '<span class="rank">' + (index + 1) + '</span>' +
                            '<div class="player-info">' +
                                '<div class="player-name">' + entry.name + '</div>' +
                                '<div class="player-id">' + entry.studentId + '</div>' +
                            '</div>' +
                            '<div class="score-info">' +
                                '<div class="score">' + entry.score + 'ì </div>' +
                                '<div class="level">Lv.' + entry.level + '</div>' +
                            '</div>' +
                        '</div>';
                    }).join('');
                }
            });
        }

        // ì…ë ¥ ê²€ì¦
        function validateInputs() {
            var nameValid = userNameInput.value.trim().length > 0;
            var idValid = studentIdInput.value.trim().length > 0;
            loginBtn.disabled = !(nameValid && idValid);
        }

        userNameInput.addEventListener('input', validateInputs);
        studentIdInput.addEventListener('input', validateInputs);

        // ë¡œê·¸ì¸
        loginBtn.addEventListener('click', function() {
            userName = userNameInput.value.trim();
            studentId = studentIdInput.value.trim();
            
            loginScreen.classList.remove('active');
            gameScreen.classList.add('active');
            document.getElementById('playerDisplay').textContent = 'í”Œë ˆì´ì–´: ' + userName + ' (' + studentId + ')';
            
            initGame();
        });

        // ìˆœìœ„í‘œ í† ê¸€
        document.getElementById('showLeaderboardBtn').addEventListener('click', function() {
            var leaderboardDiv = document.getElementById('leaderboardLogin');
            leaderboardDiv.style.display = leaderboardDiv.style.display === 'none' ? 'block' : 'none';
        });

        // ê²Œì„ ì´ˆê¸°í™”
        function initGame() {
            canvas = document.getElementById('gameCanvas');
            ctx = canvas.getContext('2d');

            raccoon = { x: 1, y: 1 };
            direction = { x: 1, y: 0 };
            score = 0;
            level = 1;
            lives = 3;
            
            generateObstacles();
            generateFruits();
            updateDisplay();
            
            if (gameInterval) clearInterval(gameInterval);
            gameInterval = setInterval(gameLoop, GAME_SPEED);
            
            document.addEventListener('keydown', handleKeyPress);
        }

        // ì¥ì• ë¬¼ ìƒì„±
        function generateObstacles() {
            obstacles = [];
            var obstacleCount = Math.min(level * 2, 15);
            
            for (var i = 0; i < obstacleCount; i++) {
                var pos;
                var attempts = 0;
                do {
                    pos = {
                        x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                        y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                    };
                    attempts++;
                } while (
                    attempts < 100 &&
                    ((pos.x === raccoon.x && pos.y === raccoon.y) ||
                     obstacles.some(function(o) { return o.x === pos.x && o.y === pos.y; }) ||
                     (pos.x === 1 && pos.y === 1))
                );
                
                if (attempts < 100) {
                    obstacles.push(pos);
                }
            }
        }

        // ê³¼ì¼ ìƒì„±
        function generateFruits() {
            fruits = [];
            var fruitCount = 3 + level;
            
            for (var i = 0; i < fruitCount; i++) {
                var pos;
                var attempts = 0;
                do {
                    pos = {
                        x: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1,
                        y: Math.floor(Math.random() * (GRID_SIZE - 2)) + 1
                    };
                    attempts++;
                } while (
                    attempts < 100 &&
                    ((pos.x === raccoon.x && pos.y === raccoon.y) ||
                     obstacles.some(function(o) { return o.x === pos.x && o.y === pos.y; }) ||
                     fruits.some(function(f) { return f.x === pos.x && f.y === pos.y; }))
                );
                
                if (attempts < 100) {
                    fruits.push(pos);
                }
            }
        }

        // í‚¤ë³´ë“œ ì…ë ¥ ì²˜ë¦¬
        function handleKeyPress(e) {
            switch(e.key) {
                case 'ArrowUp':
                    if (direction.y === 0) direction = { x: 0, y: -1 };
                    break;
                case 'ArrowDown':
                    if (direction.y === 0) direction = { x: 0, y: 1 };
                    break;
                case 'ArrowLeft':
                    if (direction.x === 0) direction = { x: -1, y: 0 };
                    break;
                case 'ArrowRight':
                    if (direction.x === 0) direction = { x: 1, y: 0 };
                    break;
            }
        }

        // ê²Œì„ ë£¨í”„
        function gameLoop() {
            var newPos = {
                x: raccoon.x + direction.x,
                y: raccoon.y + direction.y
            };

            // ë²½ ì¶©ëŒ ì²´í¬
            if (newPos.x < 0 || newPos.x >= GRID_SIZE || newPos.y < 0 || newPos.y >= GRID_SIZE) {
                loseLife();
                return;
            }

            // ì¥ì• ë¬¼ ì¶©ëŒ ì²´í¬
            if (obstacles.some(function(o) { return o.x === newPos.x && o.y === newPos.y; })) {
                loseLife();
                return;
            }

            raccoon = newPos;

            // ê³¼ì¼ ë¨¹ê¸°
            var fruitIndex = fruits.findIndex(function(f) { return f.x === raccoon.x && f.y === raccoon.y; });
            if (fruitIndex !== -1) {
                fruits.splice(fruitIndex, 1);
                score += 10 * level;
                
                if (fruits.length === 0) {
                    level++;
                    generateObstacles();
                    generateFruits();
                }
            }

            updateDisplay();
            draw();
        }

        // ìƒëª… ê°ì†Œ
        function loseLife() {
            lives--;
            if (lives <= 0) {
                gameOver();
            } else {
                raccoon = { x: 1, y: 1 };
                direction = { x: 1, y: 0 };
            }
            updateDisplay();
        }

        // ê²Œì„ ì˜¤ë²„
        function gameOver() {
            clearInterval(gameInterval);
            document.removeEventListener('keydown', handleKeyPress);
            
            saveScore(score, level);
            
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = 'ë ˆë²¨ ' + level;
            
            gameScreen.classList.remove('active');
            gameoverScreen.classList.add('active');
        }

        // í™”ë©´ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateDisplay() {
            document.getElementById('level').textContent = level;
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('fruits').textContent = fruits.length;
        }

        // ê²Œì„ ê·¸ë¦¬ê¸°
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ë²½ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#92400e';
            for (var x = 0; x < GRID_SIZE; x++) {
                ctx.fillRect(x * CELL_SIZE, 0, CELL_SIZE, CELL_SIZE);
                ctx.fillRect(x * CELL_SIZE, (GRID_SIZE - 1) * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }
            for (var y = 1; y < GRID_SIZE - 1; y++) {
                ctx.fillRect(0, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                ctx.fillRect((GRID_SIZE - 1) * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
            }

            // ë°”ë‹¥ ê·¸ë¦¬ê¸°
            ctx.fillStyle = '#86efac';
            for (var x = 1; x < GRID_SIZE - 1; x++) {
                for (var y = 1; y < GRID_SIZE - 1; y++) {
                    ctx.fillRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                }
            }

            // ê·¸ë¦¬ë“œ ì„  ê·¸ë¦¬ê¸°
            ctx.strokeStyle = '#bbf7d0';
            ctx.lineWidth = 1;
            for (var x = 1; x < GRID_SIZE - 1; x++) {
                for (var y = 1; y < GRID_SIZE - 1; y++) {
                    ctx.strokeRect(x * CELL_SIZE, y * CELL_SIZE, CELL_SIZE, CELL_SIZE);
                }
            }

            // ì¥ì• ë¬¼ ê·¸ë¦¬ê¸°
            ctx.font = '24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            obstacles.forEach(function(obs) {
                ctx.fillText('ğŸŒ³', obs.x * CELL_SIZE + CELL_SIZE/2, obs.y * CELL_SIZE + CELL_SIZE/2);
            });

            // ê³¼ì¼ ê·¸ë¦¬ê¸°
            fruits.forEach(function(fruit) {
                ctx.fillText('ğŸ', fruit.x * CELL_SIZE + CELL_SIZE/2, fruit.y * CELL_SIZE + CELL_SIZE/2);
            });

            // ë„ˆêµ¬ë¦¬ ê·¸ë¦¬ê¸°
            ctx.fillText('ğŸ¦', raccoon.x * CELL_SIZE + CELL_SIZE/2, raccoon.y * CELL_SIZE + CELL_SIZE/2);
        }

        // ë‹¤ì‹œ ì‹œì‘
        document.getElementById('replayBtn').addEventListener('click', function() {
            gameoverScreen.classList.remove('active');
            gameScreen.classList.add('active');
            initGame();
        });

        // ë¡œê·¸ì•„ì›ƒ
        document.getElementById('logoutBtn').addEventListener('click', function() {
            gameoverScreen.classList.remove('active');
            loginScreen.classList.add('active');
            userName = '';
            studentId = '';
            userNameInput.value = '';
            studentIdInput.value = '';
            validateInputs();
        });

        // ì´ˆê¸°í™”
        loadLeaderboard();
    </script>
</body>
</html>